#!/bin/bash
set -ex
# This script reads services.txt
# It generates a docker compose up command enabling all the services that are not commented out

cd /opt/adsblol
DOCKER_COMPOSE_CMD="docker compose up -d"
SERVICES=$(cat services.txt|grep -v "^#")
for service in $SERVICES
do
    DOCKER_COMPOSE_CMD="$DOCKER_COMPOSE_CMD $service"
done

set +ex
echo "I have made a docker compose command for you, enabling what you have selected in services.txt."
echo $DOCKER_COMPOSE_CMD
echo "It is also been saved to /opt/adsblol/cmdline.txt"
echo $DOCKER_COMPOSE_CMD > /opt/adsblol/cmdline.txt
echo "This command will be used by adsblol-up"
echo "You can run this command now, or run adsblol-up to run it automatically"
echo

# Get the RTLSDRs so we can put them in docker-compose.yaml as devices using this format
# /dev/adsblol1, /dev/adsblol2, etc
