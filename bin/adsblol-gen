#!/bin/bash
set -ex
# FIXME https://github.com/containerd/nerdctl/issues/1831
# This script reads services.txt
# default-docker-compose.yaml has all the services
# If the service has a matching field in its profiles section, it will be Carried Over

# Generate header of docker-compose.yaml
cd /opt/adsblol
cat << EOF > docker-compose.yaml
version: "3.8"
services: {}
EOF


SERVICES=$(cat services.txt|grep -v "^#")
for service in $SERVICES
do
    yq ".services.$service *= load(\"default-docker-compose.yaml\").services.$service" docker-compose.yaml > docker-compose.yaml.tmp
    mv docker-compose.yaml.tmp docker-compose.yaml
done

# Get the RTLSDRs so we can put them in docker-compose.yaml as devices using this format
# /dev/adsblol1, /dev/adsblol2, etc
